# TODO List 项目说明文档

## 1. 技术选型

### 编程语言：Go
理由：编译型语言，性能优异，并发处理能力强，生态成熟，适合构建高性能后端服务。Go的标准库丰富，使得开发Web服务变得简单高效，同时具有良好的跨平台能力。

### 框架/库：原生Go + 标准库
理由：使用Go标准库中的net/http包构建Web服务，无需额外依赖，减少项目复杂度，易于部署和维护。标准库提供的功能足以满足本项目的需求，避免了引入第三方框架可能带来的额外学习成本和潜在兼容性问题。

### 数据库/存储：SQLite
理由：轻量级嵌入式数据库，无需独立服务器进程，数据存储在单一文件中，便于部署和备份。对于个人任务管理应用，SQLite的性能完全足够，同时简化了应用的安装和配置流程。数据量不大的情况下，SQLite提供了很好的读写性能。

### 替代方案对比：
- **为什么不用MongoDB**：MongoDB作为文档型数据库更适合处理非结构化或半结构化数据，而任务管理应用的数据结构相对固定，SQLite的关系型模型更适合。此外，MongoDB需要额外的服务器安装和维护，增加了部署复杂性。
- **为什么不用本地文件**：直接使用文件存储会导致数据管理复杂，特别是在需要索引、事务和并发访问时。SQLite提供了事务支持和更可靠的数据完整性保障。

### 前端技术：HTML5 + CSS3 + JavaScript
理由：纯前端技术栈，无需额外的前端框架，降低了项目复杂度。对于中小型应用，原生JavaScript已足够应对大部分交互需求，同时减少了加载时间和资源消耗。

## 2. 项目结构设计

### 整体架构说明
本项目采用前后端分离的架构设计：
- **前端**：单页应用，通过AJAX与后端API进行通信
- **后端**：RESTful API服务，处理数据的增删改查和业务逻辑
- **数据库**：SQLite数据库存储用户、设备和任务数据
- **同步机制**：基于时间戳和版本控制的双向同步策略

### 目录结构示例
```
TodoLists/
├── data/              # 数据库文件目录
│   └── todolist.db    # SQLite数据库文件
├── db/                # 数据库相关模块
│   ├── auth.go        # 用户认证功能
│   ├── database.go    # 数据库连接和初始化
│   ├── device.go      # 设备管理功能
│   ├── module.go      # 数据库模块定义
│   └── sync.go        # 数据同步功能
├── main.go            # 应用入口
├── static/            # 静态资源
│   ├── index.html     # 主页面
│   └── js/            # JavaScript模块
│       ├── auth.js    # 前端认证模块
│       ├── sync.js    # 前端同步模块
│       └── todo.js    # 任务管理模块
├── go.mod             # Go模块定义
└── go.sum             # 依赖版本锁定
```

### 模块职责说明
- **db/database.go**：负责数据库连接初始化、表结构创建和基础操作封装
- **db/auth.go**：实现用户注册、登录、认证等功能，包括JWT token生成和验证
- **db/device.go**：处理设备注册、识别和管理，支持多设备登录场景
- **db/sync.go**：实现数据同步核心逻辑，包括冲突检测和解决机制
- **main.go**：应用入口，配置路由，启动Web服务器
- **static/js/auth.js**：前端认证相关功能，处理登录、注册和token管理
- **static/js/sync.js**：前端同步模块，负责与后端同步数据，处理网络状态变化
- **static/js/todo.js**：核心任务管理功能，包括CRUD操作和界面交互

## 3. 需求细节与决策

### 任务描述是否必填？
任务名称为必填项，不能为空；任务描述为可选项。系统会对空输入进行验证，确保至少有任务名称。

### 已完成任务的显示方式
- UI中使用不同样式区分已完成任务（如划线、变灰等）
- 任务列表可以根据完成状态进行筛选和排序
- 已完成任务在同步过程中保持其完成状态

### 任务排序逻辑
- 默认按创建时间倒序（最新的任务在前）
- 用户可选择按以下方式排序：
  - 创建时间（升序/降序）
  - 截止时间（升序/降序）
  - 优先级（高优先级在前）
- 排序功能在前端实现，通过JavaScript对获取到的数据进行重新排序（主要靠AI生成了这块代码）

### 扩展功能设计思路
- **数据同步**：
  - 采用基于时间戳的同步策略
  - 每个任务记录最后修改时间和版本号
  - 同步时比较版本号和时间戳，检测冲突
  - 当检测到冲突时，提供用户选择保留本地版本或服务器版本

- **多设备支持**：
  - 每个登录设备分配唯一设备ID
  - 设备信息存储在数据库中，与用户关联
  - 用户可查看和管理已登录的设备

- **离线工作**：
  - 使用localStorage存储本地数据更改
  - 监听网络状态变化，在网络恢复时自动同步
  - 记录未同步操作队列，确保数据一致性

## 4. AI 使用说明

### 是否使用AI工具？
是，使用了AI编程助手进行项目开发辅助。

### 使用AI的环节：
- **代码片段生成**：生成基础的数据结构定义、CRUD操作函数、API路由处理等
- **Bug定位**：协助分析和解决同步冲突处理中的逻辑问题
- **性能优化建议**：获取关于SQL查询优化和并发处理的建议
- **安全最佳实践**：获取关于密码加密存储和JWT安全配置的建议
- **文档初稿编写**：生成项目文档框架和技术选型分析

### AI输出如何修改：
- AI提供的初始数据模型只包含基本字段，我进行了扩展，增加了版本号、设备ID、创建/更新时间等字段以支持同步功能
- AI建议使用简单的HTTP状态码返回错误，我改为返回更详细的错误信息JSON对象，包含错误代码和描述
- AI初始方案中的同步机制较为简单，我增加了更复杂的冲突检测和解决逻辑
- 对数据库查询进行了优化，添加了必要的索引以提高性能
- 增强了安全性措施，如密码哈希加盐、JWT过期时间设置等

## 5. 运行与测试方式

### 本地运行方式
1. **安装依赖**
   ```bash
   go mod download
   ```

2. **启动应用**
   ```bash
   go run main.go
   ```

3. **访问应用**
   打开浏览器，访问 `http://localhost:8080`

### 已测试过的环境
- **操作系统**：macOS, Windows
- **Go版本**：Go 1.18+
- **浏览器**：Chrome 90+, Firefox 88+, Safari 14+

### 已知问题与不足
- **同步冲突处理**：当前的冲突解决机制依赖于用户手动选择，在某些场景下可能不够智能
- **离线数据量**：使用localStorage存储离线数据，存在存储空间限制，大量任务可能导致存储溢出
- **并发性能**：在多用户高并发场景下，SQLite的性能可能成为瓶颈
- **安全考虑**：当前实现适合个人使用，企业环境可能需要额外的安全加固措施
- **测试覆盖度**：单元测试和集成测试覆盖度有待提高

## 6. 总结与反思

### 如果有更多时间，你会如何改进？
- **数据存储升级**：考虑在数据量增长时支持迁移到PostgreSQL等更强大的关系型数据库
- **实时同步**：实现WebSocket实时数据同步，减少轮询频率，提升用户体验
- **任务共享功能**：支持用户间的任务共享和协作功能
- **通知提醒**：添加基于时间的任务提醒功能
- **完整的测试套件**：增加单元测试、集成测试和端到端测试
- **Docker支持**：提供Docker容器化配置，简化部署过程
- **用户界面优化**：添加更多主题选择和自定义选项

### 实现的最大亮点
- **简洁高效的架构**：使用Go标准库和轻量级技术栈，实现了高性能的后端服务
- **可靠的数据同步机制**：设计了完善的多设备数据同步方案，包括冲突检测和解决
- **离线工作能力**：支持用户在无网络环境下继续使用应用，网络恢复后自动同步
- **安全性考虑**：实现了JWT认证、密码加密存储等安全措施
- **模块化设计**：前后端代码结构清晰，易于维护和扩展